name: TXDeploy
on:
  push:
    branches:
      - docs
    paths:
      - 'packages/**/**'
      - 'docs/**/**'
      - 'scripts/**/**'
      - 'package.json'

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2.3.1
    
    - name: Install & Build ğŸ”§ # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
      run: npm i
      
    - name: BootstrapğŸ”§ # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
      run: ./node_modules/.bin/lerna bootstrap
      
    - name: DocsBuildğŸ”§ # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
      run: npm run docsBuild

    - name: Remove zipsğŸ”§ # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
      run: rm -rf *.zip

    - name: Deploy
      uses: easingthemes/ssh-deploy@main
      env:
        # æœ¬åœ°.sshæ–‡ä»¶ä¸‹çš„ç§é’¥id_rsaï¼Œå­˜åœ¨secretsçš„TOKENä¸­
        SSH_PRIVATE_KEY: ${{ secrets.LUCAS_PRIVATE_KEY }} 
        # å¤åˆ¶æ“ä½œçš„å‚æ•°ã€‚"-avzr --delete"æ„å‘³éƒ¨ç½²æ—¶æ¸…ç©ºæœåŠ¡å™¨ç›®æ ‡ç›®å½•ä¸‹çš„æ–‡ä»¶
        # æºç›®å½•ï¼Œç›¸å¯¹äº$GITHUB_WORKSPACEæ ¹ç›®å½•çš„è·¯å¾„
        SOURCE: docs/.vitepress/dist/
        # æœåŠ¡å™¨åŸŸå
        REMOTE_HOST: ${{ secrets.GP_TX_IP }}
        # è…¾è®¯äº‘é»˜è®¤ç”¨æˆ·åä¸ºroot
        REMOTE_USER: root 
        # ç›®æ ‡ç›®å½•
        TARGET: /data/web-packages/p/traction-widget
